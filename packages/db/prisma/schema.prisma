// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enums for model fields
enum DataSource {
  network_json
  dom_table

  @@map("data_source")
}

enum BlobKind {
  network_json
  html

  @@map("blob_kind")
}

// Models for Phase P2.2
model UsageEvent {
  id          String     @id @default(uuid())
  captured_at DateTime   @db.Timestamptz()
  source      DataSource
  raw_blob    RawBlob?  @relation(fields: [raw_blob_id], references: [id])
  raw_blob_id String?   @db.Uuid

  @@map("usage_events")
  @@index([captured_at])
}

model Snapshot {
  id            String   @id @default(uuid())
  captured_at   DateTime @db.Timestamptz()
  table_hash    String
  rows_count    Int

  @@map("snapshots")
  @@index([captured_at])
}

model RawBlob {
  id          String    @id @default(uuid())
  captured_at DateTime  @db.Timestamptz()
  kind        BlobKind
  url         String?
  payload     Bytes
  usage_events UsageEvent[]

  @@map("raw_blobs")
}
